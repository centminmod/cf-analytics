# Cloudflare Zone Analytics API Script

This Cloudflare Zone Analytics API script supports both traditional Cloufdlare Global API Token authentication (`CF_GLOBAL_TOKEN='y'`) and newer non-global Cloudflare permission based API Token authentication (`CF_GLOBAL_TOKEN='n'`) which is currently in beta testing. The `cf-analytics.sh` script is currently default to `CF_GLOBAL_TOKEN='n'` for testing purposes.

If you have Cloudflare Argo enabled on your CF zone, also set `CF_ARGO='y'` - currently enabled by default for testing purposes.

## Usage

```
export zid=YOUR_CLOUDFLARE_DOMAIN_ZONE_ID
export cfkey=YOUR_CLOUDFLARE_API_KEY
export cfemail=YOUR_CLOUDFLARE_ACCOUNT_EMAIL
```

```
./cf-analytics.sh 
./cf-analytics.sh {6hrs|12hrs|24hrs|week|month|custom}
```

```
./cf-analytics.sh 24hrs                  
------------------------------------------------------------------
  Cloudflare Argo Analytics
------------------------------------------------------------------
  since: 2019-05-14T08:25:00Z
  until: 2019-05-16T08:25:00Z
------------------------------------------------------------------
  Argo Response Time:
------------------------------------------------------------------
  request-without-argo: 12444
  request-with-argo: 112867
  argo-smarted-routed: 86.9%
  argo-improvement: 60.3600%
  without-argo: 391 (milliseconds)
  with-argo 155 (milliseconds)
------------------------------------------------------------------
  Argo Cloudflare Datacenter Response Times
------------------------------------------------------------------
  ATL  27726  0.6412169622075149   332.2533929162529   119.20688162735338
  IAD  20332  0.637232322143707    325.6395870736086   118.13151682077513
  FRA  12189  0.5799126291327171   456.80453879941433  191.89781770448766
  AMS  11529  0.5992252513882197   449.694421657096    180.22616879174257
  SEA  7162   0.40508913312922673  115.13461538461539  68.49483384529461
  CDG  3421   0.6144501422449614   516.3040345821325   199.06094709149372
  SIN  3294   0.5962180930008604   595.7072829131653   240.53582270795386
  LHR  2993   0.607285979424051    495.1811594202899   194.46458402940195
  KBP  2628   0.630100508063133    664.1783216783217   245.67922374429224
  EWR  2165   0.5481618158546426   301.8181818181818   136.3729792147806
  HKG  1858   0.5351932505240897   481.1136363636364   223.6248654467169
  ARN  1776   0.5904696408044352   523.052995391705    214.2060810810811
  NRT  1719   0.5622481824455847   371.9059405940594   162.8025014543339
  YVR  1579   0.47559111222426925  143.32914572864323  75.16307789740343
  DME  1438   0.6299202921502316   715.1506024096385   264.6627260083449
  MIA  1396   0.5052764125545139   274.3493150684931   135.72707736389685
  AKL  1229   0.47349360130316764  678.6486486486486   357.3128559804719
  GRU  1228   0.5791630868985488   727.2328244274809   306.0464169381107
  DUB  1085   0.7477442456057896   723.125             182.41244239631337
  MUC  958    0.5202992390439672   476.3429752066116   228.50208768267223
  ORD  827    0.5596108552294217   200.08823529411765  88.11668681983072
  ATH  646    0.6528382488219177   682.1794871794872   236.8266253869969
  HAM  645    0.3746478854738678   347.1470588235294   217.0891472868217
  LED  624    0.5968830264246223   589                 237.43589743589743
  SJC  538    0.5174183945246018   384.4718309859155   185.53903345724908
  DFW  537    0.49549020899323587  166.60714285714286  84.05493482309124
  MXP  496    0.6310643720804437   537.8921568627451   198.44758064516128
  BUD  496    0.6345091268874329   590.5392156862745   215.8366935483871
  LAX  480    0.33667051911778867  163.25471698113208  108.29166666666667
  total-argo-reqs: 112994
  datacenter-calc-avg-resp-without: 391.3434
  datacenter-calc-avg-resp-with: 155.0828
  argo-improvement:
      min: 0.3367
      avg: 0.5613
      max: 0.7477
      stddev: 0.0890
  argo-resp-time-without-argo:
      min: 115.1346
      avg: 449.2464
      max: 727.2328
      stddev: 187.9968
  argo-resp-time-with-argo:
      min: 68.4948
      avg: 186.7645
      max: 357.3129
      stddev: 69.3717

------------------------------------------------------------------
  Cloudflare Zone Analytics
------------------------------------------------------------------
  since: 2019-05-15T08:00:00Z
  until: 2019-05-16T08:00:00Z
------------------------------------------------------------------
  Requests:
------------------------------------------------------------------
  requests all: 210786
  requests cached: 121962
  requests uncached: 88824
  requests ssl-encrypted: 192936
  requests ssl-unencrypted: 17850

------------------------------------------------------------------
  Pageviews:
------------------------------------------------------------------
  "all": 68410,
  "search_engine": 
    "applebot": 48,
    "baiduspider": 59,
    "bingbot": 3425,
    "duckduckgobot": 16,
    "facebookexternalhit": 32,
    "googlebot": 8782,
    "twitterbot": 21,
    "yandexbot": 191

------------------------------------------------------------------
  Requests HTTP Status Codes:
------------------------------------------------------------------
  "200": 158097,
  "206": 56,
  "301": 5664,
  "302": 16122,
  "303": 20509,
  "304": 3239,
  "307": 2725,
  "400": 6,
  "401": 48,
  "403": 1122,
  "404": 2213,
  "405": 31,
  "416": 20,
  "499": 836,
  "500": 49,
  "520": 30,
  "521": 4,
  "522": 13,
  "524": 2

------------------------------------------------------------------
  Requests SSL Protocols:
------------------------------------------------------------------
  "TLSv1.2": 107921,
  "TLSv1.3": 85015,
  "none": 17850

------------------------------------------------------------------
  Requests Content Types:
------------------------------------------------------------------
  "css": 11045,
  "empty": 4068,
  "gif": 1601,
  "html": 116691,
  "javascript": 32455,
  "jpeg": 3845,
  "json": 2687,
  "octet-stream": 687,
  "other": 7722,
  "plain": 541,
  "png": 17120,
  "svg": 16,
  "webp": 10769,
  "xml": 1539

------------------------------------------------------------------
  Requests IP Class:
------------------------------------------------------------------
  "backupService": 8,
  "badHost": 266,
  "monitoringService": 1187,
  "noRecord": 164488,
  "searchEngine": 26197,
  "tor": 36,
  "unknown": 17720,
  "whitelist": 884

------------------------------------------------------------------
  Requests Country Top 20:
------------------------------------------------------------------
  "US": 75093
  "DE": 25898
  "FR": 12666
  "GB": 9121
  "IN": 8321
  "NL": 6328
  "AU": 6125
  "JP": 5803
  "SG": 5646
  "CN": 4989
  "RU": 4236
  "VN": 3769
  "BR": 3207
  "IT": 2620
  "UA": 2540
  "ID": 2433
  "CA": 2113
  "IE": 1946
  "ES": 1822
  "PL": 1702

------------------------------------------------------------------
  Bandwidth:
------------------------------------------------------------------
  bandwidth all: 3965159403
  bandwidth cached: 2828614040
  bandwidth uncached: 1136545363
  bandwidth ssl-encrypted: 3942345957
  bandwidth ssl-unencrypted: 22813446

------------------------------------------------------------------
  Bandwidth SSL Protocols:
------------------------------------------------------------------
  "TLSv1.2": 107921,
  "TLSv1.3": 85015,
  "none": 17850

------------------------------------------------------------------
  Bandwidth Content Types:
------------------------------------------------------------------
  "css": 110432021,
  "empty": 1613685,
  "gif": 23706010,
  "html": 1378194797,
  "javascript": 383366648,
  "jpeg": 22221380,
  "json": 3169046,
  "octet-stream": 1421601743,
  "other": 318212843,
  "plain": 7690615,
  "png": 179223248,
  "svg": 444479,
  "webp": 82602938,
  "xml": 32679950

------------------------------------------------------------------
  Bandwidth Country Top 20:
------------------------------------------------------------------
  "US": 1170533462
  "DE": 546377403
  "SG": 339702426
  "CA": 194209335
  "FR": 160271949
  "GB": 149483971
  "RU": 149136945
  "JP": 138803647
  "CN": 116845836
  "VN": 114655733
  "NL": 100682606
  "IN": 89108683
  "UA": 76885477
  "AU": 75727230
  "XX": 56446705
  "IT": 53701367
  "ID": 43347263
  "BR": 32500156
  "IE": 26437821
  "ES": 23383311

------------------------------------------------------------------
  Threats:
------------------------------------------------------------------
  "all": 59,
  "type": 
    "bic.ban.unknown": 59
  ,
  "country": 
    "BG": 1,
    "CA": 4,
    "DE": 1,
    "ES": 1,
    "PL": 1,
    "RO": 3,
    "UA": 46,
    "US": 2
```
