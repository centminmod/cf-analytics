# Cloudflare Zone Analytics API Script

This Cloudflare Zone Analytics API script supports both traditional Cloufdlare Global API Token authentication (`CF_GLOBAL_TOKEN='y'`) and newer non-global Cloudflare permission based API Token authentication (`CF_GLOBAL_TOKEN='n'`) which is currently in beta testing. The `cf-analytics.sh` script is currently default to `CF_GLOBAL_TOKEN='n'` for testing purposes.

If you have Cloudflare Argo enabled on your CF zone, also set `CF_ARGO='y'` - currently enabled by default for testing purposes.

## Usage

```
export zid=YOUR_CLOUDFLARE_DOMAIN_ZONE_ID
export cfkey=YOUR_CLOUDFLARE_API_KEY
export cfemail=YOUR_CLOUDFLARE_ACCOUNT_EMAIL
```

```
./cf-analytics.sh 
./cf-analytics.sh {6hrs|12hrs|24hrs|week|month|custom}
```

```
./cf-analytics.sh 24hrs                                                 
------------------------------------------------------------------
  Cloudflare Argo Analytics
------------------------------------------------------------------
  since: 2019-05-13T21:53:00Z
  until: 2019-05-15T07:55:00Z
------------------------------------------------------------------
  Argo Response Time:
------------------------------------------------------------------
  request-without-argo: 6282
  request-with-argo: 56404
  argo-smarted-routed: 86.2%
  argo-improvement: 60.0600%
  without-argo: 383 (milliseconds)
  with-argo 153 (milliseconds)
------------------------------------------------------------------
  Argo Cloudflare Datacenter Response Times
------------------------------------------------------------------
  ATL  14584  0.6288817279605762   330.5444305381727   122.67107789358201
  LHR  1604   0.6415915970039859   472.99723756906076  169.52618453865335
  DME  1250   0.6375640659208469   726.6608391608391   263.368
  HAM  597    0.3539220653522123   333.6392405063291   215.5569514237856
  ORD  761    0.5590327372450438   207.5609756097561   91.52759526938239
  ARN  1276   0.538852376849302    475.388198757764    219.22413793103448
  FRA  3405   0.6163214864285327   533.5953608247422   204.72907488986783
  AMS  1822   0.6683572200088377   582.8351955307263   193.29308452250274
  AKL  772    0.4643016303689894   698.7755102040817   374.33290155440415
  NRT  1487   0.560084374861064    367.3787878787879   161.61566913248151
  SJC  429    0.5023774280374559   399.81481481481484  198.95687645687644
  EWR  997    0.6232081453363305   303.7109375         114.4358074222668
  SIN  2004   0.6172478683329683   639.2209302325581   244.6631736526946
  SEA  5231   0.3900570082855188   119.93859649122807  73.15570636589563
  IAD  13435  0.6250579033758243   327.0426829268293   122.62206922218087
  CDG  935    0.5750737863559962   512.445054945055    217.75133689839572
  YVR  965    0.4740699772952203   148.33333333333334  78.01295336787565
  BNE  543    0.44177230205679574  659.8015873015873   368.3195211786372
  HKG  1335   0.5311103779910232   474.05405405405406  222.27902621722848
  GRU  842    0.5846446654195169   706.1320754716982   293.2957244655582
  KBP  1549   0.6220275590440028   659.6005917159763   249.31084570690768
  MIA  637    0.6002104551734758   286.71875           114.62715855572998
  total-argo-reqs: 56460
  datacenter-calc-avg-resp-without: 382.6575
  datacenter-calc-avg-resp-with: 153.1784
  argo-improvement:
      min: 0.3539
      avg: 0.5571
      max: 0.6684
      stddev: 0.0863
  argo-resp-time-without-argo:
      min: 119.9386
      avg: 453.0086
      max: 726.6608
      stddev: 184.7685
  argo-resp-time-with-argo:
      min: 73.1557
      avg: 196.0579
      max: 374.3329
      stddev: 84.1581

------------------------------------------------------------------
  Cloudflare Zone Analytics
------------------------------------------------------------------
  since: 2019-05-14T07:00:00Z
  until: 2019-05-15T07:00:00Z
------------------------------------------------------------------
  Requests:
------------------------------------------------------------------
  requests all: 191884
  requests cached: 127096
  requests uncached: 64788
  requests ssl-encrypted: 172692
  requests ssl-unencrypted: 19192

------------------------------------------------------------------
  Pageviews:
------------------------------------------------------------------
  "all": 55200,
  "search_engine": 
    "applebot": 101,
    "baiduspider": 56,
    "bingbot": 2163,
    "duckduckgobot": 18,
    "facebookexternalhit": 35,
    "googlebot": 7426,
    "linkedinbot": 2,
    "twitterbot": 10,
    "yandexbot": 260

------------------------------------------------------------------
  Requests HTTP Status Codes:
------------------------------------------------------------------
  "200": 148212,
  "206": 9,
  "301": 2579,
  "302": 17095,
  "303": 11893,
  "304": 3405,
  "307": 1307,
  "400": 1,
  "401": 48,
  "403": 4695,
  "404": 1182,
  "405": 28,
  "416": 41,
  "499": 1287,
  "500": 48,
  "502": 1,
  "520": 49,
  "521": 3,
  "524": 1

------------------------------------------------------------------
  Requests SSL Protocols:
------------------------------------------------------------------
  "TLSv1.2": 85141,
  "TLSv1.3": 87551,
  "none": 19192

------------------------------------------------------------------
  Requests Content Types:
------------------------------------------------------------------
  "css": 11735,
  "empty": 4676,
  "gif": 1573,
  "html": 94031,
  "javascript": 34272,
  "jpeg": 3945,
  "json": 2701,
  "octet-stream": 895,
  "other": 7277,
  "plain": 600,
  "png": 17366,
  "svg": 15,
  "webp": 11283,
  "xml": 1515

------------------------------------------------------------------
  Requests IP Class:
------------------------------------------------------------------
  "backupService": 2,
  "badHost": 276,
  "monitoringService": 1186,
  "noRecord": 152806,
  "searchEngine": 26665,
  "tor": 59,
  "unknown": 10055,
  "whitelist": 835

------------------------------------------------------------------
  Requests Country Top 20:
------------------------------------------------------------------
  "US": 74891
  "DE": 11078
  "IN": 9438
  "GB": 9317
  "AU": 6607
  "CN": 6327
  "NL": 5884
  "JP": 5650
  "SG": 5467
  "FR": 5455
  "BR": 4683
  "RU": 4568
  "VN": 3364
  "UA": 2654
  "CA": 1912
  "ES": 1868
  "IT": 1736
  "XX": 1728
  "ID": 1618
  "KR": 1551

------------------------------------------------------------------
  Bandwidth:
------------------------------------------------------------------
  bandwidth all: 3804632636
  bandwidth cached: 2901507138
  bandwidth uncached: 903125498
  bandwidth ssl-encrypted: 3779440901
  bandwidth ssl-unencrypted: 25191735

------------------------------------------------------------------
  Bandwidth SSL Protocols:
------------------------------------------------------------------
  "TLSv1.2": 85141,
  "TLSv1.3": 87551,
  "none": 19192

------------------------------------------------------------------
  Bandwidth Content Types:
------------------------------------------------------------------
  "css": 119960416,
  "empty": 1645864,
  "gif": 17315259,
  "html": 1118576198,
  "javascript": 403906052,
  "jpeg": 18807593,
  "json": 3092292,
  "octet-stream": 1465368296,
  "other": 357661822,
  "plain": 10503388,
  "png": 178933927,
  "svg": 1266387,
  "webp": 84729729,
  "xml": 22865413

------------------------------------------------------------------
  Bandwidth Country Top 20:
------------------------------------------------------------------
  "US": 1135174099
  "DE": 498213287
  "SG": 362244606
  "GB": 156782322
  "RU": 135958061
  "CN": 105655000
  "JP": 105333961
  "UA": 104995604
  "KR": 102458941
  "IN": 100094988
  "VN": 90696111
  "FI": 84113479
  "AU": 78242333
  "FR": 76389295
  "NL": 64895084
  "RO": 53852728
  "CA": 49106865
  "BR": 45676866
  "XX": 40255475
  "ID": 33304305

------------------------------------------------------------------
  Threats:
------------------------------------------------------------------
  "all": 24,
  "type": 
    "bic.ban.unknown": 24
  ,
  "country": 
    "CA": 1,
    "CN": 4,
    "IT": 1,
    "NG": 3,
    "NL": 1,
    "RO": 7,
    "T1": 2,
    "US": 5
```
